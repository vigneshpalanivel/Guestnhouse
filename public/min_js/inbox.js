app.directive("postsPagination",function(){return{restrict:"E",template:'<ul class="pagination"><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="messages_result(1)">&laquo;</a></li><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="messages_result(currentPage-1)">&lsaquo; '+$("#pagin_prev").val()+' </a></li><li ng-repeat="i in range" ng-class="{active : currentPage == i}"><a href="javascript:void(0)" ng-click="messages_result(i)">{{i}}</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="messages_result(currentPage+1)"> '+$("#pagin_next").val()+' &rsaquo;</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="messages_result(totalPages)">&raquo;</a></li></ul>'}}).controller("inbox",["$scope","$http",function(a,e){a.today=new Date,setTimeout(function(){a.totalPages=0,a.currentPage=1,a.range=[],pageNumber=1,void 0===pageNumber&&(pageNumber="1");var t=$("#inbox_filter_select").val(),n=a.user_id;e.post("inbox/message_by_type",{data:n,type:t}).then(function(e){a.message_result=e.data,a.totalPages=e.data.last_page,a.currentPage=e.data.current_page;for(var t=[],n=1;n<=e.data.last_page;n++)t.push(n);a.range=t}),e.post("inbox/message_count",{data:n,type:t}).then(function(e){a.message_count=e.data}),a.messages_result=function(t){void 0===t&&(t="1");var n=$("#inbox_filter_select").val(),i=a.user_id;e.post("inbox/message_by_type?page="+t,{data:i,type:n}).then(function(e){a.message_result=e.data,a.totalPages=e.data.last_page,a.currentPage=e.data.current_page;for(var t=[],n=1;n<=e.data.last_page;n++)t.push(n);a.range=t})},a.archive=function(t,i,r,s){e.post("inbox/archive",{id:i,msg_id:r,type:s}).then(function(i){"Archive"==s&&(a.message_result.data[t].archive=1),"Unarchive"==s&&(a.message_result.data[t].archive=0),e.post("inbox/message_count",{data:n,type:s}).then(function(e){a.message_count=e.data})})},a.star=function(t,i,r,s){e.post("inbox/star",{id:i,msg_id:r,type:s}).then(function(i){"Star"==s&&(a.message_result.data[t].star=1),"Unstar"==s&&(a.message_result.data[t].star=0),e.post("inbox/message_count",{data:n,type:s}).then(function(e){a.message_count=e.data})})},$("#inbox_filter_select").change(function(){var t=this.value,n=a.user_id;e.post("inbox/message_by_type",{data:n,type:t}).then(function(i){a.message_result=i.data,a.totalPages=i.data.last_page,a.currentPage=i.data.current_page;for(var r=[],s=1;s<=i.data.last_page;s++)r.push(s);a.range=r,e.post("inbox/message_count",{data:n,type:t}).then(function(e){a.message_count=e.data})})})},10)}]),app.controller("conversation",["$scope","$http",function(a,e){function t(a,t,n,i){$(".special-offer-date-fields").addClass("loading"),e.post("../../rooms/price_calculation",{checkin:t,checkout:a,guest_count:n,room_id:i}).then(function(a){$(".special-offer-date-fields").removeClass("loading"),"Not available"==a.data.status?$("#availability_warning").removeClass("hide"):$("#availability_warning").addClass("hide"),$("#pricing_price").val(a.data.subtotal),$("#availability_status").val(a.data.status)})}function n(a){var t=a;e.post("../../rooms/rooms_calendar",{data:t}).then(function(a){$("#pricing_price").val(a.data.price)})}a.calculation_status="",a.reply_message=function(a){var t=$('[data-key="'+a+'"] textarea[name="message"]').val(),n=$('[data-key="'+a+'"] input[name="template"]').val();if(2==n){if(""==$("#pricing_start_date").val()||""==$("#pricing_end_date").val())return $("#availability_warning").removeClass("hide"),"";if(""==$("#pricing_price").val())return $("#availability_warning1").removeClass("hide"),"";$("#availability_warning").addClass("hide"),$("#availability_warning1").addClass("hide")}e.post(APP_URL+"/messaging/qt_reply/"+$("#reservation_id").val(),{message:t,template:n,pricing_room_id:$("#pricing_room_id").val(),pricing_checkin:$("#pricing_start_date").val(),pricing_checkout:$("#pricing_end_date").val(),pricing_guests:$("#pricing_guests").val(),pricing_price:$("#pricing_price").val()}).then(function(e){"false"!=e.data.success?($("#thread-list").prepend(e.data),$('[data-key="'+a+'"] textarea[name="message"]').val(""),$(".inquiry-form-fields").addClass("hide"),$('[data-tracking-section="accept"] ul').addClass("hide"),$('[data-tracking-section="decline"] ul').addClass("hide"),$('[data-tracking-section="discussion"] ul').addClass("hide")):$('[data-error="price"]').html(e.data.msg)})},$(document).on("change","#month-dropdown",function(){var a=$(this).val(),t=a.split("-")[0],n=a.split("-")[1],i={};i.month=n,i.year=t,i.reservation_id=$("#reservation_id").val(),i.room_id=$("#hosting").val();var r=JSON.stringify(i);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:r}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),!1}),$(document).on("click",".nextMonth, .previousMonth",function(){var a=$(this).attr("data-month"),t=$(this).attr("data-year"),n={};n.month=a,n.year=t,n.reservation_id=$("#reservation_id").val(),n.room_id=$("#hosting").val();var i=JSON.stringify(n);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:i}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),!1}),$(document).on("click","#hosting",function(){var a={},t=$("#month-dropdown").val(),n=t.split("-")[0],i=t.split("-")[1];a.month=i,a.year=n,a.reservation_id=$("#reservation_id").val(),a.room_id=$(this).val();var r=JSON.stringify(a);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:r}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),$("#edit_calendar_url").attr("href",APP_URL+"/manage-listing/"+$(this).val()+"/calendar"),!1}),$("#month-dropdown").val($("#month-dropdown_value").val()),$("#hosting").val($("#room_id").val()),$(document).on("click",".offer_attach",function(){$(".inquiry-form-fields").removeClass("hide"),$('[data-tracking-section="accept"] ul').removeClass("hide"),$('[data-tracking-section="accept"] input[name="template"][value=2]').prop("checked",!0);var a=$('[data-tracking-section="accept"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),$(document).on("click",".pre_approve",function(){$(".inquiry-form-fields").removeClass("hide"),$('[data-tracking-section="accept"] ul').removeClass("hide"),$('[data-tracking-section="accept"] input[name="template"][value=1]').prop("checked",!0);var a=$('[data-tracking-section="accept"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),$(document).on("click",".option-list a",function(){var a=$(this).parent().data("tracking-section");$("[data-tracking-section] ul").addClass("hide"),$('[data-tracking-section="'+a+'"] ul').removeClass("hide");var e=$('[data-tracking-section="'+a+'"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+e+'"] .drawer').removeClass("hide")}),$(document).on("click",'input[name="template"]',function(){$("[data-key] .drawer").addClass("hide");var a=$(this).parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),setTimeout(function(){var a=$("#pricing_room_id").val();e.post("../../rooms/rooms_calendar",{data:a}).then(function(a){var e=(a.data.changed_price,a.data.not_avilable);$("#pricing_start_date").datepicker({minDate:0,dateFormat:"dd-mm-yy",beforeShowDay:function(a){var a=jQuery.datepicker.formatDate("yy-mm-dd",a);return $.inArray(a,e)!=-1?[!1]:[!0]},onSelect:function(a){var e=$("#pricing_start_date").datepicker("getDate");e.setDate(e.getDate()+1),$("#pricing_end_date").datepicker("setDate",e),$("#pricing_end_date").datepicker("option","minDate",e),setTimeout(function(){$("#pricing_end_date").datepicker("show")},20);var n=$(this).val(),e=$("#pricing_end_date").val(),i=$("#pricing_guests").val(),r=$("#pricing_room_id").val();t(e,n,i,r),a!=new Date&&$(".ui-datepicker-today").removeClass("ui-datepicker-today")}}),jQuery("#pricing_end_date").datepicker({minDate:1,dateFormat:"dd-mm-yy",beforeShowDay:function(a){var a=jQuery.datepicker.formatDate("yy-mm-dd",a);return $.inArray(a,e)!=-1?[!1]:[!0]},onClose:function(){var a=$("#pricing_start_date").datepicker("getDate"),e=$("#pricing_end_date").datepicker("getDate");if(e<=a&&""!=$("#pricing_start_date").val()){var n=$("#pricing_end_date").datepicker("option","minDate");$("#pricing_end_date").datepicker("setDate",n)}var e=$(this).val(),a=$("#pricing_start_date").val(),i=$("#pricing_guests").val(),r=$("#pricing_room_id").val();""!=a&&t(e,a,i,r)}}),$("#pricing_room_id").change(function(){var a=$(this).val();""!=a&&n(a)})})},10)}]),$(document).on("contextmenu",'a[data-method="post"]',function(){return!1}),$(document).on("click",'a[data-method="post"]',function(){$('a[data-method="post"]').attr("disabled","disabled")});