function step(e){$(".frm").hide(),$("#sf"+e).show()}function next(e){v.form()&&(11!=e?($(".frm").hide(),$("#sf"+(e+1)).show()):document.getElementById("add_room_form").submit())}function back(e){$(".frm").hide(),$("#sf"+(e-1)).show()}$("#input_dob").datepicker({dateFormat:"dd-mm-yy"});var night_value=$("#night").val(),week=$("#week").val(),month=$("#month").val(),currency_code=$("#currency_code").find("option:selected").prop("value"),v=$("#add_room_form").validate({rules:{calendar:{required:!0},bedrooms:{required:!0},beds:{required:!0},bed_type:{required:!0},bathrooms:{required:!0},property_type:{required:!0},room_type:{required:!0},accommodates:{required:!0},"language[]":{required:!0},country:{required:!0},address_line_1:{required:!0},city:{required:!0},state:{required:!0},night:{required:!0,digits:!0,min:1},week:{digits:!0},month:{digits:!0},video:{url:!0},"photos[]":{required:{depends:function(e){return 0==$("#js-photo-grid li").length}},extension:"png|jpg|jpeg|gif"},cancel_policy:{required:!0},user_id:{required:!0}},errorElement:"span",errorClass:"text-danger",extension:"Only png file is allowed!"});jQuery.extend(jQuery.validator.messages,{min:jQuery.validator.format("Please enter a value greater than 0")}),$.validator.addMethod("extension",function(e,t,o){return o="string"==typeof o?o.replace(/,/g,"|"):"png|jpe?g|gif",this.optional(t)||e.match(new RegExp(".("+o+")$","i"))},$.validator.format("Please upload the images like JPG,JPEG,PNG,GIF File Only.")),$(".frm").hide(),$(".frm#sf1").show(),app.controller("rooms_admin",["$scope","$http","$compile",function($scope,$http,$compile){function initAutocomplete(){autocomplete=new google.maps.places.Autocomplete(document.getElementById("address_line_1")),autocomplete.addListener("place_changed",fillInAddress)}function fillInAddress(){$scope.autocomplete_used=!0,fetchMapAddress(autocomplete.getPlace())}function fetchMapAddress(e){"street_address"==e.types&&($scope.location_found=!0);var t={street_number:"short_name",route:"long_name",sublocality_level_1:"long_name",sublocality:"long_name",locality:"long_name",administrative_area_level_1:"long_name",country:"short_name",postal_code:"short_name"};$("#city").val(""),$("#state").val(""),$("#country").val(""),$("#address_line_1").val(""),$("#address_line_2").val(""),$("#postal_code").val("");var o=e;$scope.street_number="";for(var a=0;a<o.address_components.length;a++){var n=o.address_components[a].types[0];if(t[n]){var r=o.address_components[a][t[n]];if("street_number"==n&&($scope.street_number=r),"route"==n)var i=$scope.street_number+" "+r;$("#address_line_1").val($.trim(i)),"postal_code"==n&&$("#postal_code").val(r),"locality"==n&&$("#city").val(r),"administrative_area_level_1"==n&&$("#state").val(r),"country"==n&&$("#country").val(r)}}var s=($("#address_line_1").val(),o.geometry.location.lat()),d=o.geometry.location.lng();""==$("#address_line_1").val()&&$("#address_line_1").val($("#city").val()),""==$("#city").val()&&$("#city").val(""),""==$("#state").val()&&$("#state").val(""),""==$("#postal_code").val()&&$("#postal_code").val(""),$("#latitude").val(s),$("#longitude").val(d)}function disableAdditionalGuestCharge(){"0"==$("#additional_guest").val()?$("#guests").prop("disabled",!0):$("#guests").prop("disabled",!1)}initAutocomplete(),$scope.rows=[],$(document).ready(function(){var e=$("#room_id").val();$http.post(APP_URL+"/get_lang_details/"+e,{}).then(function(e){$scope.rows=e.data,$http.post(APP_URL+"/get_lang",{}).then(function(e){$scope.lang_list=e.data})})}),$scope.location_found=!1,$scope.autocomplete_used=!1;var autocomplete;$scope.addNewRow=function(){var e=$scope.rows.length+1;$scope.rows.push({id:"rows"+e})},$scope.removeRow=function(name){for(var index=name,comArr=eval($scope.rows),i=0;i<comArr.length;i++)if(comArr[i].name===name){index=i;break}$scope.rows.splice(index,1)},$("#username").autocomplete({source:APP_URL+"/"+ADMIN_URL+"/rooms/users_list",select:function(e,t){$("#user_id").val(t.item.id)}}),$(document).on("click",".month-nav",function(){var e=$(this).attr("data-month"),t=$(this).attr("data-year"),o={};o.month=e,o.year=t;var a=JSON.stringify(o);return $http.post(APP_URL+"/"+ADMIN_URL+"/ajax_calendar/"+$("#room_id").val(),{data:a}).then(function(e){$("#ajax_container").html($compile(e.data)($scope))}),!1}),$(document).on("change","#calendar_dropdown",function(){var e=$(this).val(),t=e.split("-")[0],o=e.split("-")[1],a={};a.month=o,a.year=t;var n=JSON.stringify(a);return $http.post(APP_URL+"/"+ADMIN_URL+"/ajax_calendar/"+$("#room_id").val(),{data:n}).then(function(e){$("#ajax_container").html($compile(e.data)($scope))}),!1}),$(document).on("click",".delete-photo-btn",function(){var e=$(this).attr("data-photo-id"),t=$("#room_id").val();$('[id^="photo_li_"]').size()>1?$http.post(APP_URL+"/"+ADMIN_URL+"/delete_photo",{photo_id:e,room_id:t}).then(function(t){"true"==t.data.success&&$("#photo_li_"+e).remove()}):alert("You cannnot delete last photo. Please upload alternate photos and delete this photo.")}),$(document).on("click",".featured-photo-btn",function(){var e=$(this).attr("data-featured-id"),t=$("input[id=room_id]").val();$http.post(APP_URL+"/"+ADMIN_URL+"/featured_image",{id:t,photo_id:e}).then(function(e){"true"==e.data.success&&alert("success")})}),$(document).on("keyup",".highlights",function(){var e=$(this).val(),t=$(this).attr("data-photo-id");$("#saved_message").fadeIn(),$http.post(APP_URL+"/"+ADMIN_URL+"/photo_highlights",{photo_id:t,data:e}).then(function(e){$("#saved_message").fadeOut()})}),$(document).on("change","#additional_guest",function(){disableAdditionalGuestCharge()}),disableAdditionalGuestCharge()}]);